@model SocialNetwork.Models.ViewModels.HomeViewModel

@{
    ViewData["Title"] = "Home Page";
}

<div class="container">
    <div class="row">
        <div class="col-sm">
            <!-- Form to post a status update -->
            @using (Html.BeginForm("StatusPost", "Status", FormMethod.Post))
            {
                @Html.LabelFor(m => m.Post.Content)
                @Html.TextBoxFor(m => m.Post.Content)
                <input type="submit" value="Post Update" />
            }
        </div>
        <div class="col-sm">
            One of three columns
        </div>
    </div>
</div>

<script src="~/js/signalr.js"></script>
<script>
    "use strict";

    var connection = new signalR.HubConnectionBuilder()
        .withUrl("/global")
        .configureLogging(signalR.LogLevel.Information)
        .build();

    connection.start().then(
        () => console.log("connected")
    ).catch(
        err => console.error(err)
    );
    
    connection.on("BroadcastMessage", function (user, message) {
        console.log('received');
        var msg = message.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        var encodedMsg = user + " says " + msg;
        var li = document.createElement("li");
        li.textContent = encodedMsg;
        alert(encodedMsg);
    });
</script>
